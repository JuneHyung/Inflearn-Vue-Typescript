# 12. 점진적인 타입스크립트 적용 방식 3단계 - Vuex 스토어 타입 정의

## 스토어 TS 파일 변환 및 컴포넌트의 타입 추론 문제 소개

```typescript
import Vue from 'vue'
import App from './App.vue'
import router from './routes/index';
import store from './store/index.js';

Vue.config.productionTip = false

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app')

```

여기서 여태까지 router의 타입정의까지 살펴보았고, 이제 store쪽을 살펴보자.

store의 index.js -> ts로 변환.

들어가기전에❗ store에서는 타입시스템에 대한 이해가 좀 더 필요하다.<br/>ts로 바꿧을때 에러가 발생하지 않지만, 가져다 쓸때 어떤문제가 생기는지 살펴보자.

App.vue created에서 store에 접근해보자.

```vue
<template>
...
</template>
<script lang="ts">
    ...
    create(){
        this.$store.state.
    }
...
</script>
```

state까지는 추론을 통해 찾을 수 있지만, 그 뒤로는 추론이 되지않는 것을 볼 수 있다.

```vue
// store/index.ts
...
export default new Vuex.Store({
  strict: process.env.NODE_ENV !== 'production',
  state: {
    news: [],
    ask: [],
    jobs: [],
    user: {},
    item: {},
    list: []
  },
  getters,
  mutations,
  actions
});
```

이처럼 state가 정의 되있지만, 추론이 되지않아 자바스크립트처럼 사용해야하는 경우가 발생한다.



## 스토어의 타입 추론이 안되는 이유 분석

$store를 타고 들어가게 되면 vue.d.ts파일로 가게 된다.

```vue
declare module "vue/types/options" {
  interface ComponentOptions<V extends Vue> {
    store?: Store<any>;
  }
}
      
declare module "vue/types/vue" {
  interface Vue {
    $store: Store<any>;
  }
}
```

this.$store의 타입추론을 보게되면, Vue라고 정의되있는 타입안에서 $store를 확장했다고 보면된다.

Vue내부적으로 여러 속성들의 기본적인 타입을 정의 해놓았다.

interface merging이라고 해서 두번 인터페이스를 쓰게되면 두개의 인터페이스가 합쳐진다.

이거를 declaration merging(선언 병합) 이라고한다.

참고 : [타입스크립트 선언 병합(declaration mergin)](https://www.typescriptlang.org/docs/handbook/declaration-merging.html)



Store를 쫒아 들어가보자.

this.$store는 `Store<any>`로 추론이 되고있다. 저말은 any가 제네릭으로 들어간다는 것이고,

Store를 보면 아래의 S라는 타입에 any가 들어가 관련 된 모든 속성들이 any로 추론되는 것이다.

```vue
export declare class Store<S> {
  constructor(options: StoreOptions<S>);

  readonly state: S;
  readonly getters: any;

  replaceState(state: S): void;

  dispatch: Dispatch;
  commit: Commit;

  subscribe<P extends MutationPayload>(fn: (mutation: P, state: S) => any, options?: SubscribeOptions): () => void;
....
```

그렇기 때문에 state에 any가 들어가 news등 추론이 되지않는다.
